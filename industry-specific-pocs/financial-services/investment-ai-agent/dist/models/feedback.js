"use strict";
// Feedback models and interfaces
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateFeedbackPriority = exports.determineFeedbackSentiment = exports.createFeedbackId = exports.validateFeedback = void 0;
// Validation functions
const validateFeedback = (feedback) => {
    const errors = [];
    // Required fields
    if (!feedback.userId)
        errors.push('User ID is required');
    if (!feedback.feedbackType)
        errors.push('Feedback type is required');
    if (!feedback.category)
        errors.push('Category is required');
    if (!feedback.title)
        errors.push('Title is required');
    if (!feedback.description)
        errors.push('Description is required');
    // Rating validation
    if (feedback.rating === undefined || feedback.rating === null) {
        errors.push('Rating is required');
    }
    else if (!Number.isInteger(feedback.rating) || feedback.rating < 1 || feedback.rating > 5) {
        errors.push('Rating must be an integer between 1 and 5');
    }
    // Type validations
    const validFeedbackTypes = [
        'investment-idea-quality',
        'analysis-accuracy',
        'system-performance',
        'user-experience',
        'feature-request',
        'bug-report',
        'general'
    ];
    if (feedback.feedbackType && !validFeedbackTypes.includes(feedback.feedbackType)) {
        errors.push('Invalid feedback type');
    }
    const validCategories = [
        'accuracy',
        'relevance',
        'completeness',
        'timeliness',
        'usability',
        'performance',
        'compliance',
        'other'
    ];
    if (feedback.category && !validCategories.includes(feedback.category)) {
        errors.push('Invalid category');
    }
    // String length validations
    if (feedback.title && feedback.title.length > 200) {
        errors.push('Title must be 200 characters or less');
    }
    if (feedback.description && feedback.description.length > 2000) {
        errors.push('Description must be 2000 characters or less');
    }
    // Array validations
    if (feedback.tags && !Array.isArray(feedback.tags)) {
        errors.push('Tags must be an array');
    }
    return {
        valid: errors.length === 0,
        errors
    };
};
exports.validateFeedback = validateFeedback;
const createFeedbackId = () => {
    return `feedback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
};
exports.createFeedbackId = createFeedbackId;
const determineFeedbackSentiment = (rating, description) => {
    // Simple sentiment analysis based on rating and keywords
    if (rating >= 4)
        return 'positive';
    if (rating <= 2)
        return 'negative';
    // For neutral ratings (3), analyze description for sentiment keywords
    const positiveKeywords = ['good', 'great', 'excellent', 'helpful', 'useful', 'accurate', 'fast'];
    const negativeKeywords = ['bad', 'poor', 'terrible', 'slow', 'inaccurate', 'confusing', 'broken'];
    const lowerDescription = description.toLowerCase();
    const positiveCount = positiveKeywords.filter(word => lowerDescription.includes(word)).length;
    const negativeCount = negativeKeywords.filter(word => lowerDescription.includes(word)).length;
    if (positiveCount > negativeCount)
        return 'positive';
    if (negativeCount > positiveCount)
        return 'negative';
    return 'neutral';
};
exports.determineFeedbackSentiment = determineFeedbackSentiment;
const calculateFeedbackPriority = (feedback) => {
    // Priority calculation based on multiple factors
    let score = 0;
    // Rating impact
    if (feedback.rating <= 2)
        score += 3;
    else if (feedback.rating === 3)
        score += 1;
    // Type impact
    if (feedback.feedbackType === 'bug-report')
        score += 2;
    if (feedback.feedbackType === 'system-performance')
        score += 2;
    if (feedback.feedbackType === 'analysis-accuracy')
        score += 2;
    // Category impact
    if (feedback.category === 'accuracy')
        score += 2;
    if (feedback.category === 'compliance')
        score += 3;
    if (feedback.category === 'performance')
        score += 1;
    // Sentiment impact
    if (feedback.sentiment === 'negative')
        score += 1;
    if (score >= 5)
        return 'high';
    if (score >= 3)
        return 'medium';
    return 'low';
};
exports.calculateFeedbackPriority = calculateFeedbackPriority;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVlZGJhY2suanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbW9kZWxzL2ZlZWRiYWNrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpQ0FBaUM7OztBQTRLakMsdUJBQXVCO0FBQ2hCLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxRQUFhLEVBQXdDLEVBQUU7SUFDdEYsTUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO0lBRTVCLGtCQUFrQjtJQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU07UUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDekQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZO1FBQUUsTUFBTSxDQUFDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQ3JFLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUTtRQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUM1RCxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUs7UUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDdEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXO1FBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBRWxFLG9CQUFvQjtJQUNwQixJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssU0FBUyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssSUFBSSxFQUFFO1FBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQztLQUNuQztTQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUMzRixNQUFNLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxDQUFDLENBQUM7S0FDMUQ7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SSxDQUFDLENBQUM7SUFFbEQsSUFBSSxLQUFLLElBQUksQ0FBQztRQUFFLE9BQU8sTUFBTSxDQUFDO0lBQzlCLElBQUksS0FBSyxJQUFJLENBQUM7UUFBRSxPQUFPLFFBQVEsQ0FBQztJQUNoQyxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMsQ0FBQztBQXhCVyxRQUFBLHlCQUF5Qiw2QkF3QnBDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmVlZGJhY2sgbW9kZWxzIGFuZCBpbnRlcmZhY2VzXG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2sge1xuICBpZDogc3RyaW5nO1xuICB1c2VySWQ6IHN0cmluZztcbiAgaW52ZXN0bWVudElkZWFJZD86IHN0cmluZztcbiAgYW5hbHlzaXNJZD86IHN0cmluZztcbiAgcmVxdWVzdElkPzogc3RyaW5nO1xuICBmZWVkYmFja1R5cGU6IEZlZWRiYWNrVHlwZTtcbiAgcmF0aW5nOiBudW1iZXI7IC8vIDEtNSBzY2FsZVxuICBjYXRlZ29yeTogRmVlZGJhY2tDYXRlZ29yeTtcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgdGFnczogc3RyaW5nW107XG4gIHNlbnRpbWVudDogJ3Bvc2l0aXZlJyB8ICduZXV0cmFsJyB8ICduZWdhdGl2ZSc7XG4gIHByaW9yaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICBzdGF0dXM6IEZlZWRiYWNrU3RhdHVzO1xuICBtZXRhZGF0YTogRmVlZGJhY2tNZXRhZGF0YTtcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG4gIHJlc29sdmVkQXQ/OiBEYXRlO1xuICByZXNvbHZlZEJ5Pzogc3RyaW5nO1xuICByZXNvbHV0aW9uPzogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBGZWVkYmFja1R5cGUgPSBcbiAgfCAnaW52ZXN0bWVudC1pZGVhLXF1YWxpdHknXG4gIHwgJ2FuYWx5c2lzLWFjY3VyYWN5J1xuICB8ICdzeXN0ZW0tcGVyZm9ybWFuY2UnXG4gIHwgJ3VzZXItZXhwZXJpZW5jZSdcbiAgfCAnZmVhdHVyZS1yZXF1ZXN0J1xuICB8ICdidWctcmVwb3J0J1xuICB8ICdnZW5lcmFsJztcblxuZXhwb3J0IHR5cGUgRmVlZGJhY2tDYXRlZ29yeSA9IFxuICB8ICdhY2N1cmFjeSdcbiAgfCAncmVsZXZhbmNlJ1xuICB8ICdjb21wbGV0ZW5lc3MnXG4gIHwgJ3RpbWVsaW5lc3MnXG4gIHwgJ3VzYWJpbGl0eSdcbiAgfCAncGVyZm9ybWFuY2UnXG4gIHwgJ2NvbXBsaWFuY2UnXG4gIHwgJ290aGVyJztcblxuZXhwb3J0IHR5cGUgRmVlZGJhY2tTdGF0dXMgPSBcbiAgfCAnc3VibWl0dGVkJ1xuICB8ICd1bmRlci1yZXZpZXcnXG4gIHwgJ2luLXByb2dyZXNzJ1xuICB8ICdyZXNvbHZlZCdcbiAgfCAnZGlzbWlzc2VkJ1xuICB8ICdhcmNoaXZlZCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2tNZXRhZGF0YSB7XG4gIHNvdXJjZTogJ3dlYicgfCAnYXBpJyB8ICdtb2JpbGUnIHwgJ3N5c3RlbSc7XG4gIHVzZXJBZ2VudD86IHN0cmluZztcbiAgc2Vzc2lvbklkPzogc3RyaW5nO1xuICBjb250ZXh0RGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGF0dGFjaG1lbnRzPzogRmVlZGJhY2tBdHRhY2htZW50W107XG4gIHJlbGF0ZWRGZWVkYmFjaz86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZlZWRiYWNrQXR0YWNobWVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIGZpbGVuYW1lOiBzdHJpbmc7XG4gIGNvbnRlbnRUeXBlOiBzdHJpbmc7XG4gIHNpemU6IG51bWJlcjtcbiAgdXJsOiBzdHJpbmc7XG4gIHVwbG9hZGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2tTdW1tYXJ5IHtcbiAgdG90YWxDb3VudDogbnVtYmVyO1xuICBhdmVyYWdlUmF0aW5nOiBudW1iZXI7XG4gIHJhdGluZ0Rpc3RyaWJ1dGlvbjogUmVjb3JkPG51bWJlciwgbnVtYmVyPjtcbiAgY2F0ZWdvcnlCcmVha2Rvd246IFJlY29yZDxGZWVkYmFja0NhdGVnb3J5LCBudW1iZXI+O1xuICB0eXBlQnJlYWtkb3duOiBSZWNvcmQ8RmVlZGJhY2tUeXBlLCBudW1iZXI+O1xuICBzZW50aW1lbnRCcmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIHN0YXR1c0JyZWFrZG93bjogUmVjb3JkPEZlZWRiYWNrU3RhdHVzLCBudW1iZXI+O1xuICB0aW1lUmFuZ2U6IHtcbiAgICBzdGFydDogRGF0ZTtcbiAgICBlbmQ6IERhdGU7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2tBbmFseXRpY3Mge1xuICB0cmVuZHM6IEZlZWRiYWNrVHJlbmRbXTtcbiAgaW5zaWdodHM6IEZlZWRiYWNrSW5zaWdodFtdO1xuICByZWNvbW1lbmRhdGlvbnM6IEZlZWRiYWNrUmVjb21tZW5kYXRpb25bXTtcbiAgY29ycmVsYXRpb25zOiBGZWVkYmFja0NvcnJlbGF0aW9uW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2tUcmVuZCB7XG4gIG1ldHJpYzogc3RyaW5nO1xuICBwZXJpb2Q6ICdkYWlseScgfCAnd2Vla2x5JyB8ICdtb250aGx5JztcbiAgZGF0YTogQXJyYXk8e1xuICAgIGRhdGU6IERhdGU7XG4gICAgdmFsdWU6IG51bWJlcjtcbiAgICBjaGFuZ2U/OiBudW1iZXI7XG4gIH0+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZlZWRiYWNrSW5zaWdodCB7XG4gIGlkOiBzdHJpbmc7XG4gIHR5cGU6ICdpbXByb3ZlbWVudCcgfCAnaXNzdWUnIHwgJ29wcG9ydHVuaXR5JztcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgaW1wYWN0OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICBjb25maWRlbmNlOiBudW1iZXI7XG4gIHN1cHBvcnRpbmdEYXRhOiBhbnlbXTtcbiAgZ2VuZXJhdGVkQXQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmVlZGJhY2tSZWNvbW1lbmRhdGlvbiB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHByaW9yaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICBlZmZvcnQ6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gIGltcGFjdDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJztcbiAgY2F0ZWdvcnk6IHN0cmluZztcbiAgYWN0aW9uSXRlbXM6IHN0cmluZ1tdO1xuICBlc3RpbWF0ZWRUaW1lZnJhbWU6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGZWVkYmFja0NvcnJlbGF0aW9uIHtcbiAgbWV0cmljMTogc3RyaW5nO1xuICBtZXRyaWMyOiBzdHJpbmc7XG4gIGNvcnJlbGF0aW9uOiBudW1iZXI7XG4gIHNpZ25pZmljYW5jZTogbnVtYmVyO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZlZWRiYWNrRmlsdGVyIHtcbiAgdXNlcklkPzogc3RyaW5nO1xuICBpbnZlc3RtZW50SWRlYUlkPzogc3RyaW5nO1xuICBhbmFseXNpc0lkPzogc3RyaW5nO1xuICBmZWVkYmFja1R5cGU/OiBGZWVkYmFja1R5cGVbXTtcbiAgY2F0ZWdvcnk/OiBGZWVkYmFja0NhdGVnb3J5W107XG4gIHJhdGluZz86IHtcbiAgICBtaW4/OiBudW1iZXI7XG4gICAgbWF4PzogbnVtYmVyO1xuICB9O1xuICBzZW50aW1lbnQ/OiAoJ3Bvc2l0aXZlJyB8ICduZXV0cmFsJyB8ICduZWdhdGl2ZScpW107XG4gIHN0YXR1cz86IEZlZWRiYWNrU3RhdHVzW107XG4gIGRhdGVSYW5nZT86IHtcbiAgICBzdGFydDogRGF0ZTtcbiAgICBlbmQ6IERhdGU7XG4gIH07XG4gIHRhZ3M/OiBzdHJpbmdbXTtcbiAgcHJpb3JpdHk/OiAoJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJylbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGZWVkYmFja1NlYXJjaE9wdGlvbnMge1xuICBxdWVyeT86IHN0cmluZztcbiAgZmlsdGVycz86IEZlZWRiYWNrRmlsdGVyO1xuICBzb3J0Qnk/OiAnY3JlYXRlZEF0JyB8ICd1cGRhdGVkQXQnIHwgJ3JhdGluZycgfCAncHJpb3JpdHknO1xuICBzb3J0T3JkZXI/OiAnYXNjJyB8ICdkZXNjJztcbiAgbGltaXQ/OiBudW1iZXI7XG4gIG9mZnNldD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGZWVkYmFja1NlYXJjaFJlc3VsdCB7XG4gIGZlZWRiYWNrOiBGZWVkYmFja1tdO1xuICB0b3RhbENvdW50OiBudW1iZXI7XG4gIGhhc01vcmU6IGJvb2xlYW47XG4gIGFnZ3JlZ2F0aW9ucz86IHtcbiAgICBhdmVyYWdlUmF0aW5nOiBudW1iZXI7XG4gICAgY2F0ZWdvcnlCcmVha2Rvd246IFJlY29yZDxGZWVkYmFja0NhdGVnb3J5LCBudW1iZXI+O1xuICAgIHNlbnRpbWVudEJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfTtcbn1cblxuLy8gVmFsaWRhdGlvbiBmdW5jdGlvbnNcbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUZlZWRiYWNrID0gKGZlZWRiYWNrOiBhbnkpOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcnM6IHN0cmluZ1tdIH0gPT4ge1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgLy8gUmVxdWlyZWQgZmllbGRzXG4gIGlmICghZmVlZGJhY2sudXNlcklkKSBlcnJvcnMucHVzaCgnVXNlciBJRCBpcyByZXF1aXJlZCcpO1xuICBpZiAoIWZlZWRiYWNrLmZlZWRiYWNrVHlwZSkgZXJyb3JzLnB1c2goJ0ZlZWRiYWNrIHR5cGUgaXMgcmVxdWlyZWQnKTtcbiAgaWYgKCFmZWVkYmFjay5jYXRlZ29yeSkgZXJyb3JzLnB1c2goJ0NhdGVnb3J5IGlzIHJlcXVpcmVkJyk7XG4gIGlmICghZmVlZGJhY2sudGl0bGUpIGVycm9ycy5wdXNoKCdUaXRsZSBpcyByZXF1aXJlZCcpO1xuICBpZiAoIWZlZWRiYWNrLmRlc2NyaXB0aW9uKSBlcnJvcnMucHVzaCgnRGVzY3JpcHRpb24gaXMgcmVxdWlyZWQnKTtcblxuICAvLyBSYXRpbmcgdmFsaWRhdGlvblxuICBpZiAoZmVlZGJhY2sucmF0aW5nID09PSB1bmRlZmluZWQgfHwgZmVlZGJhY2sucmF0aW5nID09PSBudWxsKSB7XG4gICAgZXJyb3JzLnB1c2goJ1JhdGluZyBpcyByZXF1aXJlZCcpO1xuICB9IGVsc2UgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZlZWRiYWNrLnJhdGluZykgfHwgZmVlZGJhY2sucmF0aW5nIDwgMSB8fCBmZWVkYmFjay5yYXRpbmcgPiA1KSB7XG4gICAgZXJyb3JzLnB1c2goJ1JhdGluZyBtdXN0IGJlIGFuIGludGVnZXIgYmV0d2VlbiAxIGFuZCA1Jyk7XG4gIH1cblxuICAvLyBUeXBlIHZhbGlkYXRpb25zXG4gIGNvbnN0IHZhbGlkRmVlZGJhY2tUeXBlczogRmVlZGJhY2tUeXBlW10gPSBbXG4gICAgJ2ludmVzdG1lbnQtaWRlYS1xdWFsaXR5JyxcbiAgICAnYW5hbHlzaXMtYWNjdXJhY3knLFxuICAgICdzeXN0ZW0tcGVyZm9ybWFuY2UnLFxuICAgICd1c2VyLWV4cGVyaWVuY2UnLFxuICAgICdmZWF0dXJlLXJlcXVlc3QnLFxuICAgICdidWctcmVwb3J0JyxcbiAgICAnZ2VuZXJhbCdcbiAgXTtcblxuICBpZiAoZmVlZGJhY2suZmVlZGJhY2tUeXBlICYmICF2YWxpZEZlZWRiYWNrVHlwZXMuaW5jbHVkZXMoZmVlZGJhY2suZmVlZGJhY2tUeXBlKSkge1xuICAgIGVycm9ycy5wdXNoKCdJbnZhbGlkIGZlZWRiYWNrIHR5cGUnKTtcbiAgfVxuXG4gIGNvbnN0IHZhbGlkQ2F0ZWdvcmllczogRmVlZGJhY2tDYXRlZ29yeVtdID0gW1xuICAgICdhY2N1cmFjeScsXG4gICAgJ3JlbGV2YW5jZScsXG4gICAgJ2NvbXBsZXRlbmVzcycsXG4gICAgJ3RpbWVsaW5lc3MnLFxuICAgICd1c2FiaWxpdHknLFxuICAgICdwZXJmb3JtYW5jZScsXG4gICAgJ2NvbXBsaWFuY2UnLFxuICAgICdvdGhlcidcbiAgXTtcblxuICBpZiAoZmVlZGJhY2suY2F0ZWdvcnkgJiYgIXZhbGlkQ2F0ZWdvcmllcy5pbmNsdWRlcyhmZWVkYmFjay5jYXRlZ29yeSkpIHtcbiAgICBlcnJvcnMucHVzaCgnSW52YWxpZCBjYXRlZ29yeScpO1xuICB9XG5cbiAgLy8gU3RyaW5nIGxlbmd0aCB2YWxpZGF0aW9uc1xuICBpZiAoZmVlZGJhY2sudGl0bGUgJiYgZmVlZGJhY2sudGl0bGUubGVuZ3RoID4gMjAwKSB7XG4gICAgZXJyb3JzLnB1c2goJ1RpdGxlIG11c3QgYmUgMjAwIGNoYXJhY3RlcnMgb3IgbGVzcycpO1xuICB9XG5cbiAgaWYgKGZlZWRiYWNrLmRlc2NyaXB0aW9uICYmIGZlZWRiYWNrLmRlc2NyaXB0aW9uLmxlbmd0aCA+IDIwMDApIHtcbiAgICBlcnJvcnMucHVzaCgnRGVzY3JpcHRpb24gbXVzdCBiZSAyMDAwIGNoYXJhY3RlcnMgb3IgbGVzcycpO1xuICB9XG5cbiAgLy8gQXJyYXkgdmFsaWRhdGlvbnNcbiAgaWYgKGZlZWRiYWNrLnRhZ3MgJiYgIUFycmF5LmlzQXJyYXkoZmVlZGJhY2sudGFncykpIHtcbiAgICBlcnJvcnMucHVzaCgnVGFncyBtdXN0IGJlIGFuIGFycmF5Jyk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgIGVycm9yc1xuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUZlZWRiYWNrSWQgPSAoKTogc3RyaW5nID0+IHtcbiAgcmV0dXJuIGBmZWVkYmFja18ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XG59O1xuXG5leHBvcnQgY29uc3QgZGV0ZXJtaW5lRmVlZGJhY2tTZW50aW1lbnQgPSAocmF0aW5nOiBudW1iZXIsIGRlc2NyaXB0aW9uOiBzdHJpbmcpOiAncG9zaXRpdmUnIHwgJ25ldXRyYWwnIHwgJ25lZ2F0aXZlJyA9PiB7XG4gIC8vIFNpbXBsZSBzZW50aW1lbnQgYW5hbHlzaXMgYmFzZWQgb24gcmF0aW5nIGFuZCBrZXl3b3Jkc1xuICBpZiAocmF0aW5nID49IDQpIHJldHVybiAncG9zaXRpdmUnO1xuICBpZiAocmF0aW5nIDw9IDIpIHJldHVybiAnbmVnYXRpdmUnO1xuICBcbiAgLy8gRm9yIG5ldXRyYWwgcmF0aW5ncyAoMyksIGFuYWx5emUgZGVzY3JpcHRpb24gZm9yIHNlbnRpbWVudCBrZXl3b3Jkc1xuICBjb25zdCBwb3NpdGl2ZUtleXdvcmRzID0gWydnb29kJywgJ2dyZWF0JywgJ2V4Y2VsbGVudCcsICdoZWxwZnVsJywgJ3VzZWZ1bCcsICdhY2N1cmF0ZScsICdmYXN0J107XG4gIGNvbnN0IG5lZ2F0aXZlS2V5d29yZHMgPSBbJ2JhZCcsICdwb29yJywgJ3RlcnJpYmxlJywgJ3Nsb3cnLCAnaW5hY2N1cmF0ZScsICdjb25mdXNpbmcnLCAnYnJva2VuJ107XG4gIFxuICBjb25zdCBsb3dlckRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24udG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgcG9zaXRpdmVDb3VudCA9IHBvc2l0aXZlS2V5d29yZHMuZmlsdGVyKHdvcmQgPT4gbG93ZXJEZXNjcmlwdGlvbi5pbmNsdWRlcyh3b3JkKSkubGVuZ3RoO1xuICBjb25zdCBuZWdhdGl2ZUNvdW50ID0gbmVnYXRpdmVLZXl3b3Jkcy5maWx0ZXIod29yZCA9PiBsb3dlckRlc2NyaXB0aW9uLmluY2x1ZGVzKHdvcmQpKS5sZW5ndGg7XG4gIFxuICBpZiAocG9zaXRpdmVDb3VudCA+IG5lZ2F0aXZlQ291bnQpIHJldHVybiAncG9zaXRpdmUnO1xuICBpZiAobmVnYXRpdmVDb3VudCA+IHBvc2l0aXZlQ291bnQpIHJldHVybiAnbmVnYXRpdmUnO1xuICBcbiAgcmV0dXJuICduZXV0cmFsJztcbn07XG5cbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVGZWVkYmFja1ByaW9yaXR5ID0gKGZlZWRiYWNrOiBGZWVkYmFjayk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgPT4ge1xuICAvLyBQcmlvcml0eSBjYWxjdWxhdGlvbiBiYXNlZCBvbiBtdWx0aXBsZSBmYWN0b3JzXG4gIGxldCBzY29yZSA9IDA7XG4gIFxuICAvLyBSYXRpbmcgaW1wYWN0XG4gIGlmIChmZWVkYmFjay5yYXRpbmcgPD0gMikgc2NvcmUgKz0gMztcbiAgZWxzZSBpZiAoZmVlZGJhY2sucmF0aW5nID09PSAzKSBzY29yZSArPSAxO1xuICBcbiAgLy8gVHlwZSBpbXBhY3RcbiAgaWYgKGZlZWRiYWNrLmZlZWRiYWNrVHlwZSA9PT0gJ2J1Zy1yZXBvcnQnKSBzY29yZSArPSAyO1xuICBpZiAoZmVlZGJhY2suZmVlZGJhY2tUeXBlID09PSAnc3lzdGVtLXBlcmZvcm1hbmNlJykgc2NvcmUgKz0gMjtcbiAgaWYgKGZlZWRiYWNrLmZlZWRiYWNrVHlwZSA9PT0gJ2FuYWx5c2lzLWFjY3VyYWN5Jykgc2NvcmUgKz0gMjtcbiAgXG4gIC8vIENhdGVnb3J5IGltcGFjdFxuICBpZiAoZmVlZGJhY2suY2F0ZWdvcnkgPT09ICdhY2N1cmFjeScpIHNjb3JlICs9IDI7XG4gIGlmIChmZWVkYmFjay5jYXRlZ29yeSA9PT0gJ2NvbXBsaWFuY2UnKSBzY29yZSArPSAzO1xuICBpZiAoZmVlZGJhY2suY2F0ZWdvcnkgPT09ICdwZXJmb3JtYW5jZScpIHNjb3JlICs9IDE7XG4gIFxuICAvLyBTZW50aW1lbnQgaW1wYWN0XG4gIGlmIChmZWVkYmFjay5zZW50aW1lbnQgPT09ICduZWdhdGl2ZScpIHNjb3JlICs9IDE7XG4gIFxuICBpZiAoc2NvcmUgPj0gNSkgcmV0dXJuICdoaWdoJztcbiAgaWYgKHNjb3JlID49IDMpIHJldHVybiAnbWVkaXVtJztcbiAgcmV0dXJuICdsb3cnO1xufTsiXX0=