"use strict";
/**
 * Tests for the market data service
 */
Object.defineProperty(exports, "__esModule", { value: true });
const uuid_1 = require("uuid");
const market_data_service_1 = require("../market-data-service");
// Mock implementations
class MockMarketDataProvider {
    async connect(config) {
        return {
            provider: config.provider,
            connected: true,
            connectionId: 'mock-connection-id',
            latency: 10,
            lastUpdated: new Date(),
            activeSymbols: config.symbols.length,
            activeDataTypes: config.dataTypes,
            throttleStatus: {
                requestsPerMinute: 0,
                maxRequestsPerMinute: 5,
                throttled: false
            }
        };
    }
    async disconnect() {
        // Do nothing
    }
    getStatus() {
        return {
            provider: 'mock-provider',
            connected: true,
            connectionId: 'mock-connection-id',
            latency: 10,
            lastUpdated: new Date(),
            activeSymbols: 0,
            activeDataTypes: [],
            throttleStatus: {
                requestsPerMinute: 0,
                maxRequestsPerMinute: 5,
                throttled: false
            }
        };
    }
    async subscribeToData(symbols, dataTypes, interval) {
        // Do nothing
    }
    async unsubscribeFromData(symbols, dataTypes) {
        // Do nothing
    }
    async getHistoricalData(query) {
        return [];
    }
}
class MockMarketDataStorage {
    constructor() {
        this.data = [];
    }
    async initialize(config) {
        // Do nothing
    }
    async storeDataPoint(dataPoint) {
        this.data.push(dataPoint);
    }
    async storeDataPoints(dataPoints) {
        this.data.push(...dataPoints);
    }
    async queryData(query) {
        // Filter data based on query
        const filteredData = this.data.filter(dp => query.symbols.includes(dp.symbol) &&
            query.dataTypes.includes(dp.dataType) &&
            dp.timestamp >= query.timeRange.start &&
            dp.timestamp <= query.timeRange.end);
        return {
            data: filteredData,
            metadata: {
                query,
                count: filteredData.length,
                executionTime: 10
            }
        };
    }
    async deleteData(query) {
        const beforeCount = this.data.length;
        this.data = this.data.filter(dp => !query.symbols.includes(dp.symbol) ||
            !query.dataTypes.includes(dp.dataType) ||
            dp.timestamp < query.timeRange.start ||
            dp.timestamp > query.timeRange.end);
        return beforeCount - this.data.length;
    }
    async getStorageStats() {
        return {
            totalDataPoints: this.data.length,
            oldestDataPoint: new Date(),
            newestDataPoint: new Date(),
            dataPointsByType: {},
            storageSize: 1000
        };
    }
}
class MockMarketAlertService {
    constructor() {
        this.alerts = new Map();
    }
    async createAlert(alertConfig) {
        const id = (0, uuid_1.v4)();
        const now = new Date();
        const newAlert = {
            ...alertConfig,
            id,
            createdAt: now,
            updatedAt: now
        };
        this.alerts.set(id, newAlert);
        return newAlert;
    }
    async updateAlert(alertId, updates) {
        const existingAlert = this.alerts.get(alertId);
        if (!existingAlert) {
            throw new Error(`Alert not found: ${alertId}`);
        }
        const updatedAlert = {
            ...existingAlert,
            ...updates,
            id: existingAlert.id,
            createdAt: existingAlert.createdAt,
            updatedAt: new Date()
        };
        this.alerts.set(alertId, updatedAlert);
        return updatedAlert;
    }
    async deleteAlert(alertId) {
        return this.alerts.delete(alertId);
    }
    async getAlert(alertId) {
        return this.alerts.get(alertId) || null;
    }
    async listAlerts(userId) {
        return Array.from(this.alerts.values()).filter(alert => alert.userId === userId);
    }
    async enableAlert(alertId) {
        return this.updateAlert(alertId, { enabled: true });
    }
    async disableAlert(alertId) {
        return this.updateAlert(alertId, { enabled: false });
    }
    async processDataPoint(dataPoint) {
        return []; // No alerts triggered
    }
}
// Test suite
describe('MarketDataService', () => {
    let marketDataService;
    let mockStorage;
    let mockAlertService;
    let mockProvider;
    beforeEach(async () => {
        // Set up test environment
        mockStorage = new MockMarketDataStorage();
        mockAlertService = new MockMarketAlertService();
        mockProvider = new MockMarketDataProvider();
        marketDataService = new market_data_service_1.MarketDataService(mockStorage, mockAlertService);
        // Initialize service
        const storageConfig = {
            storageType: 'memory',
            retentionPeriod: {
                highResolution: 7,
                lowResolution: 30
            },
            aggregationIntervals: ['1min', '1hour', 'daily'],
            compressionEnabled: false
        };
        await marketDataService.initialize(storageConfig);
        // Register provider
        marketDataService.registerProvider('mock-provider', mockProvider, true);
    });
    test('should connect to market data feed', async () => {
        const feedConfig = {
            provider: 'mock-provider',
            apiKey: 'test-api-key',
            dataTypes: ['price', 'volume'],
            symbols: ['AAPL', 'MSFT'],
            interval: 'daily'
        };
        const status = await marketDataService.connectToFeed(feedConfig);
        expect(status.connected).toBe(true);
        expect(status.provider).toBe('mock-provider');
        expect(status.activeSymbols).toBe(2);
        expect(status.activeDataTypes).toEqual(['price', 'volume']);
    });
    test('should create and retrieve market alerts', async () => {
        const alertConfig = {
            name: 'Test Alert',
            symbol: 'AAPL',
            dataType: 'price',
            condition: 'greater-than',
            threshold: 150,
            enabled: true,
            userId: 'test-user',
            notificationChannels: [
                {
                    type: 'email',
                    destination: 'test@example.com',
                    enabled: true
                }
            ]
        };
        const createdAlert = await marketDataService.createAlert(alertConfig);
        expect(createdAlert.id).toBeDefined();
        expect(createdAlert.name).toBe('Test Alert');
        expect(createdAlert.symbol).toBe('AAPL');
        const retrievedAlert = await marketDataService.getAlert(createdAlert.id);
        expect(retrievedAlert).not.toBeNull();
        expect(retrievedAlert?.id).toBe(createdAlert.id);
        expect(retrievedAlert?.name).toBe('Test Alert');
    });
    // Add more tests as needed
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFya2V0LWRhdGEtc2VydmljZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3NlcnZpY2VzL19fdGVzdHNfXy9tYXJrZXQtZGF0YS1zZXJ2aWNlLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILCtCQUFvQztBQUNwQyxnRUFNZ0M7QUFjaEMsdUJBQXVCO0FBQ3ZCLE1BQU0sc0JBQXNCO0lBQzFCLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBNEI7UUFDeEMsT0FBTztZQUNMLFFBQVEsRUFBRSxNQUFNLENBQUMsUUFBUTtZQUN6QixTQUFTLEVBQUUsSUFBSTtZQUNmLFlBQVksRUFBRSxvQkFBb0I7WUFDbEMsT0FBTyxFQUFFLEVBQUU7WUFDWCxXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDdkIsYUFBYSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTTtZQUNwQyxlQUFlLEVBQUUsTUFBTSxDQUFDLFNBQVM7WUFDakMsY0FBYyxFQUFFO2dCQUNkLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3ZCLFNBQVMsRUFBRSxLQUFLO2FBQ2pCO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVTtRQUNkLGFBQWE7SUFDZixDQUFDO0lBRUQsU0FBUztRQUNQLE9BQU87WUFDTCxRQUFRLEVBQUUsZUFBZTtZQUN6QixTQUFTLEVBQUUsSUFBSTtZQUNmLFlBQVksRUFBRSxvQkFBb0I7WUFDbEMsT0FBTyxFQUFFLEVBQUU7WUFDWCxXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDdkIsYUFBYSxFQUFFLENBQUM7WUFDaEIsZUFBZSxFQUFFLEVBQUU7WUFDbkIsY0FBYyxFQUFFO2dCQUNkLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3BCLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3ZCLFNBQVMsRUFBRSxLQUFLO2FBQ2pCO1NBQ0YsQ0FBQztJ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YXJrZXQgZGF0YSBzZXJ2aWNlXG4gKi9cblxuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCc7XG5pbXBvcnQge1xuICBNYXJrZXREYXRhU2VydmljZSxcbiAgTWFya2V0RGF0YVByb3ZpZGVyLFxuICBNYXJrZXREYXRhU3RvcmFnZSxcbiAgTWFya2V0RGF0YUFsZXJ0U2VydmljZSxcbiAgU3RvcmFnZVN0YXRzXG59IGZyb20gJy4uL21hcmtldC1kYXRhLXNlcnZpY2UnO1xuaW1wb3J0IHtcbiAgTWFya2V0RGF0YUZlZWRDb25maWcsXG4gIE1hcmtldERhdGFTdG9yYWdlQ29uZmlnLFxuICBNYXJrZXREYXRhUXVlcnksXG4gIE1hcmtldERhdGFRdWVyeVJlc3VsdCxcbiAgTWFya2V0QWxlcnRDb25maWcsXG4gIE1hcmtldERhdGFQb2ludCxcbiAgTWFya2V0QWxlcnQsXG4gIE1hcmtldERhdGFGZWVkU3RhdHVzLFxuICBNYXJrZXREYXRhVHlwZSxcbiAgTWFya2V0RGF0YUludGVydmFsXG59IGZyb20gJy4uLy4uL21vZGVscy9tYXJrZXQtZGF0YSc7XG5cbi8vIE1vY2sgaW1wbGVtZW50YXRpb25zXG5jbGFzcyBNb2NrTWFya2V0RGF0YVByb3ZpZGVyIGltcGxlbWVudHMgTWFya2V0RGF0YVByb3ZpZGVyIHtcbiAgYXN5bmMgY29ubmVjdChjb25maWc6IE1hcmtldERhdGFGZWVkQ29uZmlnKTogUHJvbWlzZTxNYXJrZXREYXRhRmVlZFN0YXR1cz4ge1xuICAgIHJldHVybiB7XG4gICAgICBwcm92aWRlcjogY29uZmlnLnByb3ZpZGVyLFxuICAgICAgY29ubmVjdGVkOiB0cnVlLFxuICAgICAgY29ubmVjdGlvbklkOiAnbW9jay1jb25uZWN0aW9uLWlkJyxcbiAgICAgIGxhdGVuY3k6IDEwLFxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCksXG4gICAgICBhY3RpdmVTeW1ib2xzOiBjb25maWcuc3ltYm9scy5sZW5ndGgsXG4gICAgICBhY3RpdmVEYXRhVHlwZXM6IGNvbmZpZy5kYXRhVHlwZXMsXG4gICAgICB0aHJvdHRsZVN0YXR1czoge1xuICAgICAgICByZXF1ZXN0c1Blck1pbnV0ZTogMCxcbiAgICAgICAgbWF4UmVxdWVzdHNQZXJNaW51dGU6IDUsXG4gICAgICAgIHRocm90dGxlZDogZmFsc2VcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZGlzY29ubmVjdCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cblxuICBnZXRTdGF0dXMoKTogTWFya2V0RGF0YUZlZWRTdGF0dXMge1xuICAgIHJldHVybiB7XG4gICAgICBwcm92aWRlcjogJ21vY2stcHJvdmlkZXInLFxuICAgICAgY29ubmVjdGVkOiB0cnVlLFxuICAgICAgY29ubmVjdGlvbklkOiAnbW9jay1jb25uZWN0aW9uLWlkJyxcbiAgICAgIGxhdGVuY3k6IDEwLFxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCksXG4gICAgICBhY3RpdmVTeW1ib2xzOiAwLFxuICAgICAgYWN0aXZlRGF0YVR5cGVzOiBbXSxcbiAgICAgIHRocm90dGxlU3RhdHVzOiB7XG4gICAgICAgIHJlcXVlc3RzUGVyTWludXRlOiAwLFxuICAgICAgICBtYXhSZXF1ZXN0c1Blck1pbnV0ZTogNSxcbiAgICAgICAgdGhyb3R0bGVkOiBmYWxzZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBhc3luYyBzdWJzY3JpYmVUb0RhdGEoXG4gICAgc3ltYm9sczogc3RyaW5nW10sIFxuICAgIGRhdGFUeXBlczogTWFya2V0RGF0YVR5cGVbXSwgXG4gICAgaW50ZXJ2YWw6IE1hcmtldERhdGFJbnRlcnZhbFxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cblxuICBhc3luYyB1bnN1YnNjcmliZUZyb21EYXRhKFxuICAgIHN5bWJvbHM6IHN0cmluZ1tdLCBcbiAgICBkYXRhVHlwZXM6IE1hcmtldERhdGFUeXBlW11cbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gRG8gbm90aGluZ1xuICB9XG5cbiAgYXN5bmMgZ2V0SGlzdG9yaWNhbERhdGEocXVlcnk6IE1hcmtldERhdGFRdWVyeSk6IFByb21pc2U8TWFya2V0RGF0YVBvaW50W10+IHtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuY2xhc3MgTW9ja01hcmtldERhdGFTdG9yYWdlIGltcGxlbWVudHMgTWFya2V0RGF0YVN0b3JhZ2Uge1xuICBwcml2YXRlIGRhdGE6IE1hcmtldERhdGFQb2ludFtdID0gW107XG4gIFxuICBhc3luYyBpbml0aWFsaXplKGNvbmZpZzogTWFya2V0RGF0YVN0b3JhZ2VDb25maWcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBEbyBub3RoaW5nXG4gIH1cbiAgXG4gIGFzeW5jIHN0b3JlRGF0YVBvaW50KGRhdGFQb2ludDogTWFya2V0RGF0YVBvaW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5kYXRhLnB1c2goZGF0YVBvaW50KTtcbiAgfVxuICBcbiAgYXN5bmMgc3RvcmVEYXRhUG9pbnRzKGRhdGFQb2ludHM6IE1hcmtldERhdGFQb2ludFtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5kYXRhLnB1c2goLi4uZGF0YVBvaW50cyk7XG4gIH1cbiAgXG4gIGFzeW5jIHF1ZXJ5RGF0YShxdWVyeTogTWFya2V0RGF0YVF1ZXJ5KTogUHJvbWlzZTxNYXJrZXREYXRhUXVlcnlSZXN1bHQ+IHtcbiAgICAvLyBGaWx0ZXIgZGF0YSBiYXNlZCBvbiBxdWVyeVxuICAgIGNvbnN0IGZpbHRlcmVkRGF0YSA9IHRoaXMuZGF0YS5maWx0ZXIoZHAgPT4gXG4gICAgICBxdWVyeS5zeW1ib2xzLmluY2x1ZGVzKGRwLnN5bWJvbCkgJiZcbiAgICAgIHF1ZXJ5LmRhdGFUeXBlcy5pbmNsdWRlcyhkcC5kYXRhVHlwZSkgJiZcbiAgICAgIGRwLnRpbWVzdGFtcCA+PSBxdWVyeS50aW1lUmFuZ2Uuc3RhcnQgJiZcbiAgICAgIGRwLnRpbWVzdGFtcCA8PSBxdWVyeS50aW1lUmFuZ2UuZW5kXG4gICAgKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogZmlsdGVyZWREYXRhLFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgcXVlcnksXG4gICAgICAgIGNvdW50OiBmaWx0ZXJlZERhdGEubGVuZ3RoLFxuICAgICAgICBleGVjdXRpb25UaW1lOiAxMFxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgXG4gIGFzeW5jIGRlbGV0ZURhdGEocXVlcnk6IE1hcmtldERhdGFRdWVyeSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgYmVmb3JlQ291bnQgPSB0aGlzLmRhdGEubGVuZ3RoO1xuICAgIFxuICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5maWx0ZXIoZHAgPT4gXG4gICAgICAhcXVlcnkuc3ltYm9scy5pbmNsdWRlcyhkcC5zeW1ib2wpIHx8XG4gICAgICAhcXVlcnkuZGF0YVR5cGVzLmluY2x1ZGVzKGRwLmRhdGFUeXBlKSB8fFxuICAgICAgZHAudGltZXN0YW1wIDwgcXVlcnkudGltZVJhbmdlLnN0YXJ0IHx8XG4gICAgICBkcC50aW1lc3RhbXAgPiBxdWVyeS50aW1lUmFuZ2UuZW5kXG4gICAgKTtcbiAgICBcbiAgICByZXR1cm4gYmVmb3JlQ291bnQgLSB0aGlzLmRhdGEubGVuZ3RoO1xuICB9XG4gIFxuICBhc3luYyBnZXRTdG9yYWdlU3RhdHMoKTogUHJvbWlzZTxTdG9yYWdlU3RhdHM+IHtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxEYXRhUG9pbnRzOiB0aGlzLmRhdGEubGVuZ3RoLFxuICAgICAgb2xkZXN0RGF0YVBvaW50OiBuZXcgRGF0ZSgpLFxuICAgICAgbmV3ZXN0RGF0YVBvaW50OiBuZXcgRGF0ZSgpLFxuICAgICAgZGF0YVBvaW50c0J5VHlwZToge30gYXMgUmVjb3JkPE1hcmtldERhdGFUeXBlLCBudW1iZXI+LFxuICAgICAgc3RvcmFnZVNpemU6IDEwMDBcbiAgICB9O1xuICB9XG59XG5cbmNsYXNzIE1vY2tNYXJrZXRBbGVydFNlcnZpY2UgaW1wbGVtZW50cyBNYXJrZXREYXRhQWxlcnRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBhbGVydHM6IE1hcDxzdHJpbmcsIE1hcmtldEFsZXJ0Q29uZmlnPiA9IG5ldyBNYXAoKTtcbiAgXG4gIGFzeW5jIGNyZWF0ZUFsZXJ0KGFsZXJ0Q29uZmlnOiBPbWl0PE1hcmtldEFsZXJ0Q29uZmlnLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4pOiBQcm9taXNlPE1hcmtldEFsZXJ0Q29uZmlnPiB7XG4gICAgY29uc3QgaWQgPSB1dWlkdjQoKTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgIFxuICAgIGNvbnN0IG5ld0FsZXJ0OiBNYXJrZXRBbGVydENvbmZpZyA9IHtcbiAgICAgIC4uLmFsZXJ0Q29uZmlnLFxuICAgICAgaWQsXG4gICAgICBjcmVhdGVkQXQ6IG5vdyxcbiAgICAgIHVwZGF0ZWRBdDogbm93XG4gICAgfTtcbiAgICBcbiAgICB0aGlzLmFsZXJ0cy5zZXQoaWQsIG5ld0FsZXJ0KTtcbiAgICByZXR1cm4gbmV3QWxlcnQ7XG4gIH1cbiAgXG4gIGFzeW5jIHVwZGF0ZUFsZXJ0KGFsZXJ0SWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxNYXJrZXRBbGVydENvbmZpZz4pOiBQcm9taXNlPE1hcmtldEFsZXJ0Q29uZmlnPiB7XG4gICAgY29uc3QgZXhpc3RpbmdBbGVydCA9IHRoaXMuYWxlcnRzLmdldChhbGVydElkKTtcbiAgICBcbiAgICBpZiAoIWV4aXN0aW5nQWxlcnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQWxlcnQgbm90IGZvdW5kOiAke2FsZXJ0SWR9YCk7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHVwZGF0ZWRBbGVydDogTWFya2V0QWxlcnRDb25maWcgPSB7XG4gICAgICAuLi5leGlzdGluZ0FsZXJ0LFxuICAgICAgLi4udXBkYXRlcyxcbiAgICAgIGlkOiBleGlzdGluZ0FsZXJ0LmlkLFxuICAgICAgY3JlYXRlZEF0OiBleGlzdGluZ0FsZXJ0LmNyZWF0ZWRBdCxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgIH07XG4gICAgXG4gICAgdGhpcy5hbGVydHMuc2V0KGFsZXJ0SWQsIHVwZGF0ZWRBbGVydCk7XG4gICAgcmV0dXJuIHVwZGF0ZWRBbGVydDtcbiAgfVxuICBcbiAgYXN5bmMgZGVsZXRlQWxlcnQoYWxlcnRJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMuYWxlcnRzLmRlbGV0ZShhbGVydElkKTtcbiAgfVxuICBcbiAgYXN5bmMgZ2V0QWxlcnQoYWxlcnRJZDogc3RyaW5nKTogUHJvbWlzZTxNYXJrZXRBbGVydENvbmZpZyB8IG51bGw+IHtcbiAgICByZXR1cm4gdGhpcy5hbGVydHMuZ2V0KGFsZXJ0SWQpIHx8IG51bGw7XG4gIH1cbiAgXG4gIGFzeW5jIGxpc3RBbGVydHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPE1hcmtldEFsZXJ0Q29uZmlnW10+IHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmFsZXJ0cy52YWx1ZXMoKSkuZmlsdGVyKGFsZXJ0ID0+IGFsZXJ0LnVzZXJJZCA9PT0gdXNlcklkKTtcbiAgfVxuICBcbiAgYXN5bmMgZW5hYmxlQWxlcnQoYWxlcnRJZDogc3RyaW5nKTogUHJvbWlzZTxNYXJrZXRBbGVydENvbmZpZz4ge1xuICAgIHJldHVybiB0aGlzLnVwZGF0ZUFsZXJ0KGFsZXJ0SWQsIHsgZW5hYmxlZDogdHJ1ZSB9KTtcbiAgfVxuICBcbiAgYXN5bmMgZGlzYWJsZUFsZXJ0KGFsZXJ0SWQ6IHN0cmluZyk6IFByb21pc2U8TWFya2V0QWxlcnRDb25maWc+IHtcbiAgICByZXR1cm4gdGhpcy51cGRhdGVBbGVydChhbGVydElkLCB7IGVuYWJsZWQ6IGZhbHNlIH0pO1xuICB9XG4gIFxuICBhc3luYyBwcm9jZXNzRGF0YVBvaW50KGRhdGFQb2ludDogTWFya2V0RGF0YVBvaW50KTogUHJvbWlzZTxNYXJrZXRBbGVydFtdPiB7XG4gICAgcmV0dXJuIFtdOyAvLyBObyBhbGVydHMgdHJpZ2dlcmVkXG4gIH1cbn1cblxuLy8gVGVzdCBzdWl0ZVxuZGVzY3JpYmUoJ01hcmtldERhdGFTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgbWFya2V0RGF0YVNlcnZpY2U6IE1hcmtldERhdGFTZXJ2aWNlO1xuICBsZXQgbW9ja1N0b3JhZ2U6IE1vY2tNYXJrZXREYXRhU3RvcmFnZTtcbiAgbGV0IG1vY2tBbGVydFNlcnZpY2U6IE1vY2tNYXJrZXRBbGVydFNlcnZpY2U7XG4gIGxldCBtb2NrUHJvdmlkZXI6IE1vY2tNYXJrZXREYXRhUHJvdmlkZXI7XG4gIFxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBTZXQgdXAgdGVzdCBlbnZpcm9ubWVudFxuICAgIG1vY2tTdG9yYWdlID0gbmV3IE1vY2tNYXJrZXREYXRhU3RvcmFnZSgpO1xuICAgIG1vY2tBbGVydFNlcnZpY2UgPSBuZXcgTW9ja01hcmtldEFsZXJ0U2VydmljZSgpO1xuICAgIG1vY2tQcm92aWRlciA9IG5ldyBNb2NrTWFya2V0RGF0YVByb3ZpZGVyKCk7XG4gICAgXG4gICAgbWFya2V0RGF0YVNlcnZpY2UgPSBuZXcgTWFya2V0RGF0YVNlcnZpY2UobW9ja1N0b3JhZ2UsIG1vY2tBbGVydFNlcnZpY2UpO1xuICAgIFxuICAgIC8vIEluaXRpYWxpemUgc2VydmljZVxuICAgIGNvbnN0IHN0b3JhZ2VDb25maWc6IE1hcmtldERhdGFTdG9yYWdlQ29uZmlnID0ge1xuICAgICAgc3RvcmFnZVR5cGU6ICdtZW1vcnknLFxuICAgICAgcmV0ZW50aW9uUGVyaW9kOiB7XG4gICAgICAgIGhpZ2hSZXNvbHV0aW9uOiA3LFxuICAgICAgICBsb3dSZXNvbHV0aW9uOiAzMFxuICAgICAgfSxcbiAgICAgIGFnZ3JlZ2F0aW9uSW50ZXJ2YWxzOiBbJzFtaW4nLCAnMWhvdXInLCAnZGFpbHknXSxcbiAgICAgIGNvbXByZXNzaW9uRW5hYmxlZDogZmFsc2VcbiAgICB9O1xuICAgIFxuICAgIGF3YWl0IG1hcmtldERhdGFTZXJ2aWNlLmluaXRpYWxpemUoc3RvcmFnZUNvbmZpZyk7XG4gICAgXG4gICAgLy8gUmVnaXN0ZXIgcHJvdmlkZXJcbiAgICBtYXJrZXREYXRhU2VydmljZS5yZWdpc3RlclByb3ZpZGVyKCdtb2NrLXByb3ZpZGVyJywgbW9ja1Byb3ZpZGVyLCB0cnVlKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdzaG91bGQgY29ubmVjdCB0byBtYXJrZXQgZGF0YSBmZWVkJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGZlZWRDb25maWc6IE1hcmtldERhdGFGZWVkQ29uZmlnID0ge1xuICAgICAgcHJvdmlkZXI6ICdtb2NrLXByb3ZpZGVyJyxcbiAgICAgIGFwaUtleTogJ3Rlc3QtYXBpLWtleScsXG4gICAgICBkYXRhVHlwZXM6IFsncHJpY2UnLCAndm9sdW1lJ10sXG4gICAgICBzeW1ib2xzOiBbJ0FBUEwnLCAnTVNGVCddLFxuICAgICAgaW50ZXJ2YWw6ICdkYWlseSdcbiAgICB9O1xuICAgIFxuICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IG1hcmtldERhdGFTZXJ2aWNlLmNvbm5lY3RUb0ZlZWQoZmVlZENvbmZpZyk7XG4gICAgXG4gICAgZXhwZWN0KHN0YXR1cy5jb25uZWN0ZWQpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KHN0YXR1cy5wcm92aWRlcikudG9CZSgnbW9jay1wcm92aWRlcicpO1xuICAgIGV4cGVjdChzdGF0dXMuYWN0aXZlU3ltYm9scykudG9CZSgyKTtcbiAgICBleHBlY3Qoc3RhdHVzLmFjdGl2ZURhdGFUeXBlcykudG9FcXVhbChbJ3ByaWNlJywgJ3ZvbHVtZSddKTtcbiAgfSk7XG4gIFxuICB0ZXN0KCdzaG91bGQgY3JlYXRlIGFuZCByZXRyaWV2ZSBtYXJrZXQgYWxlcnRzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGFsZXJ0Q29uZmlnOiBPbWl0PE1hcmtldEFsZXJ0Q29uZmlnLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4gPSB7XG4gICAgICBuYW1lOiAnVGVzdCBBbGVydCcsXG4gICAgICBzeW1ib2w6ICdBQVBMJyxcbiAgICAgIGRhdGFUeXBlOiAncHJpY2UnLFxuICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlci10aGFuJyxcbiAgICAgIHRocmVzaG9sZDogMTUwLFxuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIHVzZXJJZDogJ3Rlc3QtdXNlcicsXG4gICAgICBub3RpZmljYXRpb25DaGFubmVsczogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ2VtYWlsJyxcbiAgICAgICAgICBkZXN0aW5hdGlvbjogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICAgIGVuYWJsZWQ6IHRydWVcbiAgICAgICAgfVxuICAgICAgXVxuICAgIH07XG4gICAgXG4gICAgY29uc3QgY3JlYXRlZEFsZXJ0ID0gYXdhaXQgbWFya2V0RGF0YVNlcnZpY2UuY3JlYXRlQWxlcnQoYWxlcnRDb25maWcpO1xuICAgIFxuICAgIGV4cGVjdChjcmVhdGVkQWxlcnQuaWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KGNyZWF0ZWRBbGVydC5uYW1lKS50b0JlKCdUZXN0IEFsZXJ0Jyk7XG4gICAgZXhwZWN0KGNyZWF0ZWRBbGVydC5zeW1ib2wpLnRvQmUoJ0FBUEwnKTtcbiAgICBcbiAgICBjb25zdCByZXRyaWV2ZWRBbGVydCA9IGF3YWl0IG1hcmtldERhdGFTZXJ2aWNlLmdldEFsZXJ0KGNyZWF0ZWRBbGVydC5pZCk7XG4gICAgXG4gICAgZXhwZWN0KHJldHJpZXZlZEFsZXJ0KS5ub3QudG9CZU51bGwoKTtcbiAgICBleHBlY3QocmV0cmlldmVkQWxlcnQ/LmlkKS50b0JlKGNyZWF0ZWRBbGVydC5pZCk7XG4gICAgZXhwZWN0KHJldHJpZXZlZEFsZXJ0Py5uYW1lKS50b0JlKCdUZXN0IEFsZXJ0Jyk7XG4gIH0pO1xuICBcbiAgLy8gQWRkIG1vcmUgdGVzdHMgYXMgbmVlZGVkXG59KTsiXX0=