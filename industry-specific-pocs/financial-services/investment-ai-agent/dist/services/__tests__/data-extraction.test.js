"use strict";
/**
 * Tests for data extraction utilities
 */
Object.defineProperty(exports, "__esModule", { value: true });
const data_extraction_1 = require("../../utils/data-extraction");
describe('Data Extraction Utilities', () => {
    describe('extractFromCSV', () => {
        it('should extract data from CSV content', () => {
            const csvContent = 'id,name,value\n1,test,100\n2,test2,200';
            const result = (0, data_extraction_1.extractFromCSV)(csvContent);
            expect(result.success).toBe(true);
            expect(result.dataType).toBe('tabular');
            expect(result.extractedData).toHaveLength(2);
            expect(result.extractedData[0]).toEqual({
                id: 1,
                name: 'test',
                value: 100
            });
            expect(result.extractedData[1]).toEqual({
                id: 2,
                name: 'test2',
                value: 200
            });
            expect(result.schema).toBeDefined();
        });
        it('should handle empty CSV content', () => {
            const csvContent = '';
            const result = (0, data_extraction_1.extractFromCSV)(csvContent);
            expect(result.success).toBe(false);
            expect(result.error).toContain('Empty CSV file');
        });
        it('should handle CSV without headers', () => {
            const csvContent = '1,test,100\n2,test2,200';
            const result = (0, data_extraction_1.extractFromCSV)(csvContent);
            expect(result.success).toBe(true);
            expect(result.extractedData).toHaveLength(2);
            expect(result.extractedData[0]).toHaveProperty('1', 1);
        });
    });
    describe('extractFromJSON', () => {
        it('should extract tabular data from JSON array', () => {
            const jsonContent = JSON.stringify([
                { id: 1, name: 'test', value: 100 },
                { id: 2, name: 'test2', value: 200 }
            ]);
            const result = (0, data_extraction_1.extractFromJSON)(jsonContent);
            expect(result.success).toBe(true);
            expect(result.dataType).toBe('tabular');
            expect(result.extractedData).toHaveLength(2);
            expect(result.schema).toBeDefined();
        });
        it('should extract mixed data from JSON object', () => {
            const jsonContent = JSON.stringify({
                id: 1,
                name: 'test',
                nested: {
                    key: 'value'
                }
            });
            const result = (0, data_extraction_1.extractFromJSON)(jsonContent);
            expect(result.success).toBe(true);
            expect(result.dataType).toBe('mixed');
            expect(result.extractedData).toHaveProperty('id', 1);
            expect(result.extractedData).toHaveProperty('nested.key', 'value');
        });
        it('should handle invalid JSON', () => {
            const jsonContent = '{ invalid: json }';
            const result = (0, data_extraction_1.extractFromJSON)(jsonContent);
            expect(result.success).toBe(false);
            expect(result.error).toBeDefined();
        });
    });
    describe('generateSchemaFromData', () => {
        it('should generate schema from tabular data', () => {
            const data = [
                { id: 1, name: 'test', active: true, created: '2023-01-01' },
                { id: 2, name: 'test2', active: false, created: '2023-01-02' }
            ];
            const schema = (0, data_extraction_1.generateSchemaFromData)(data);
            expect(schema.fields).toHaveLength(4);
            expect(schema.dataTypes).toEqual({
                id: 'number',
                name: 'string',
                active: 'boolean',
                created: 'date'
            });
            expect(schema.rowCount).toBe(2);
        });
        it('should handle empty data', () => {
            const data = [];
            const schema = (0, data_extraction_1.generateSchemaFromData)(data);
            expect(schema.fields).toHaveLength(0);
            expect(schema.rowCount).toBe(0);
        });
    });
    describe('determineFieldType', () => {
        it('should determine string type', () => {
            const values = ['test', 'test2', 'test3'];
            const type = (0, data_extraction_1.determineFieldType)(values);
            expect(type).toBe('string');
        });
        it('should determine number type', () => {
            const values = [1, 2, 3];
            const type = (0, data_extraction_1.determineFieldType)(values);
            expect(type).toBe('number');
        });
        it('should determine boolean type', () => {
            const values = [true, false, true];
            const type = (0, data_extraction_1.determineFieldType)(values);
            expect(type).toBe('boolean');
        });
        it('should handle mixed types', () => {
            const values = ['test', 123, true];
            const type = (0, data_extraction_1.determineFieldType)(values);
            expect(type).toBe('unknown');
        });
        it('should handle null values', () => {
            const values = [null, null, null];
            const type = (0, data_extraction_1.determineFieldType)(values);
            expect(type).toBe('unknown');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YS1leHRyYWN0aW9uLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvX190ZXN0c19fL2RhdGEtZXh0cmFjdGlvbi50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCxpRUFLcUM7QUFFckMsUUFBUSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7WUFDOUMsTUFBTSxVQUFVLEdBQUcsd0NBQXdDLENBQUM7WUFFNUQsTUFBTSxNQUFNLEdBQUcsSUFBQSxnQ0FBYyxFQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUN0QyxFQUFFLEVBQUUsQ0FBQztnQkFDTCxJQUFJLEVBQUUsTUFBTTtnQkFDWixLQUFLLEVBQUUsR0FBRzthQUNYLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUN0QyxFQUFFLEVBQUUsQ0FBQztnQkFDTCxJQUFJLEVBQUUsT0FBTztnQkFDYixLQUFLLEVBQUUsR0FBRzthQUNYLENBQUMsQ0FBQztZQUNILE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFD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dkMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRW5DLE1BQU0sSUFBSSxHQUFHLElBQUEsb0NBQWtCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRW5DLE1BQU0sSUFBSSxHQUFHLElBQUEsb0NBQWtCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRWxDLE1BQU0sSUFBSSxHQUFHLElBQUEsb0NBQWtCLEVBQUMsTUFBTSxDQUFDLENBQUM7WUFFeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBkYXRhIGV4dHJhY3Rpb24gdXRpbGl0aWVzXG4gKi9cblxuaW1wb3J0IHsgXG4gIGV4dHJhY3RGcm9tQ1NWLCBcbiAgZXh0cmFjdEZyb21KU09OLCBcbiAgZ2VuZXJhdGVTY2hlbWFGcm9tRGF0YSwgXG4gIGRldGVybWluZUZpZWxkVHlwZSBcbn0gZnJvbSAnLi4vLi4vdXRpbHMvZGF0YS1leHRyYWN0aW9uJztcblxuZGVzY3JpYmUoJ0RhdGEgRXh0cmFjdGlvbiBVdGlsaXRpZXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdleHRyYWN0RnJvbUNTVicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4dHJhY3QgZGF0YSBmcm9tIENTViBjb250ZW50JywgKCkgPT4ge1xuICAgICAgY29uc3QgY3N2Q29udGVudCA9ICdpZCxuYW1lLHZhbHVlXFxuMSx0ZXN0LDEwMFxcbjIsdGVzdDIsMjAwJztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gZXh0cmFjdEZyb21DU1YoY3N2Q29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YVR5cGUpLnRvQmUoJ3RhYnVsYXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXh0cmFjdGVkRGF0YSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leHRyYWN0ZWREYXRhWzBdKS50b0VxdWFsKHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIG5hbWU6ICd0ZXN0JyxcbiAgICAgICAgdmFsdWU6IDEwMFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmV4dHJhY3RlZERhdGFbMV0pLnRvRXF1YWwoe1xuICAgICAgICBpZDogMixcbiAgICAgICAgbmFtZTogJ3Rlc3QyJyxcbiAgICAgICAgdmFsdWU6IDIwMFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNjaGVtYSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBDU1YgY29udGVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSAnJztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gZXh0cmFjdEZyb21DU1YoY3N2Q29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yKS50b0NvbnRhaW4oJ0VtcHR5IENTViBmaWxlJyk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgQ1NWIHdpdGhvdXQgaGVhZGVycycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNzdkNvbnRlbnQgPSAnMSx0ZXN0LDEwMFxcbjIsdGVzdDIsMjAwJztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gZXh0cmFjdEZyb21DU1YoY3N2Q29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXh0cmFjdGVkRGF0YSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leHRyYWN0ZWREYXRhWzBdKS50b0hhdmVQcm9wZXJ0eSgnMScsIDEpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdleHRyYWN0RnJvbUpTT04nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IHRhYnVsYXIgZGF0YSBmcm9tIEpTT04gYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBqc29uQ29udGVudCA9IEpTT04uc3RyaW5naWZ5KFtcbiAgICAgICAgeyBpZDogMSwgbmFtZTogJ3Rlc3QnLCB2YWx1ZTogMTAwIH0sXG4gICAgICAgIHsgaWQ6IDIsIG5hbWU6ICd0ZXN0MicsIHZhbHVlOiAyMDAgfVxuICAgICAgXSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGV4dHJhY3RGcm9tSlNPTihqc29uQ29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YVR5cGUpLnRvQmUoJ3RhYnVsYXInKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXh0cmFjdGVkRGF0YSkudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zY2hlbWEpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IG1peGVkIGRhdGEgZnJvbSBKU09OIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGpzb25Db250ZW50ID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBpZDogMSxcbiAgICAgICAgbmFtZTogJ3Rlc3QnLFxuICAgICAgICBuZXN0ZWQ6IHtcbiAgICAgICAgICBrZXk6ICd2YWx1ZSdcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGV4dHJhY3RGcm9tSlNPTihqc29uQ29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZGF0YVR5cGUpLnRvQmUoJ21peGVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmV4dHJhY3RlZERhdGEpLnRvSGF2ZVByb3BlcnR5KCdpZCcsIDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leHRyYWN0ZWREYXRhKS50b0hhdmVQcm9wZXJ0eSgnbmVzdGVkLmtleScsICd2YWx1ZScpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgSlNPTicsICgpID0+IHtcbiAgICAgIGNvbnN0IGpzb25Db250ZW50ID0gJ3sgaW52YWxpZDoganNvbiB9JztcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gZXh0cmFjdEZyb21KU09OKGpzb25Db250ZW50KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ2dlbmVyYXRlU2NoZW1hRnJvbURhdGEnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBzY2hlbWEgZnJvbSB0YWJ1bGFyIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhID0gW1xuICAgICAgICB7IGlkOiAxLCBuYW1lOiAndGVzdCcsIGFjdGl2ZTogdHJ1ZSwgY3JlYXRlZDogJzIwMjMtMDEtMDEnIH0sXG4gICAgICAgIHsgaWQ6IDIsIG5hbWU6ICd0ZXN0MicsIGFjdGl2ZTogZmFsc2UsIGNyZWF0ZWQ6ICcyMDIzLTAxLTAyJyB9XG4gICAgICBdO1xuICAgICAgXG4gICAgICBjb25zdCBzY2hlbWEgPSBnZW5lcmF0ZVNjaGVtYUZyb21EYXRhKGRhdGEpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc2NoZW1hLmZpZWxkcykudG9IYXZlTGVuZ3RoKDQpO1xuICAgICAgZXhwZWN0KHNjaGVtYS5kYXRhVHlwZXMpLnRvRXF1YWwoe1xuICAgICAgICBpZDogJ251bWJlcicsXG4gICAgICAgIG5hbWU6ICdzdHJpbmcnLFxuICAgICAgICBhY3RpdmU6ICdib29sZWFuJyxcbiAgICAgICAgY3JlYXRlZDogJ2RhdGUnXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChzY2hlbWEucm93Q291bnQpLnRvQmUoMik7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZGF0YScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGE6IGFueVtdID0gW107XG4gICAgICBcbiAgICAgIGNvbnN0IHNjaGVtYSA9IGdlbmVyYXRlU2NoZW1hRnJvbURhdGEoZGF0YSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzY2hlbWEuZmllbGRzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3Qoc2NoZW1hLnJvd0NvdW50KS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdkZXRlcm1pbmVGaWVsZFR5cGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXRlcm1pbmUgc3RyaW5nIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZXMgPSBbJ3Rlc3QnLCAndGVzdDInLCAndGVzdDMnXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IGRldGVybWluZUZpZWxkVHlwZSh2YWx1ZXMpO1xuICAgICAgXG4gICAgICBleHBlY3QodHlwZSkudG9CZSgnc3RyaW5nJyk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBkZXRlcm1pbmUgbnVtYmVyIHR5cGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZXMgPSBbMSwgMiwgM107XG4gICAgICBcbiAgICAgIGNvbnN0IHR5cGUgPSBkZXRlcm1pbmVGaWVsZFR5cGUodmFsdWVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgZGV0ZXJtaW5lIGJvb2xlYW4gdHlwZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IFt0cnVlLCBmYWxzZSwgdHJ1ZV07XG4gICAgICBcbiAgICAgIGNvbnN0IHR5cGUgPSBkZXRlcm1pbmVGaWVsZFR5cGUodmFsdWVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtaXhlZCB0eXBlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IFsndGVzdCcsIDEyMywgdHJ1ZV07XG4gICAgICBcbiAgICAgIGNvbnN0IHR5cGUgPSBkZXRlcm1pbmVGaWVsZFR5cGUodmFsdWVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHR5cGUpLnRvQmUoJ3Vua25vd24nKTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBudWxsIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlcyA9IFtudWxsLCBudWxsLCBudWxsXTtcbiAgICAgIFxuICAgICAgY29uc3QgdHlwZSA9IGRldGVybWluZUZpZWxkVHlwZSh2YWx1ZXMpO1xuICAgICAgXG4gICAgICBleHBlY3QodHlwZSkudG9CZSgndW5rbm93bicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==