"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const web_search_service_1 = require("../web-search-service");
describe('WebSearchService', () => {
    const apiKey = 'test-api-key';
    const defaultSources = ['Bloomberg', 'Reuters', 'Financial Times'];
    let webSearchService;
    beforeEach(() => {
        webSearchService = new web_search_service_1.WebSearchService(apiKey, defaultSources);
    });
    describe('performWebSearch', () => {
        it('should return search results with the correct structure', async () => {
            const query = 'renewable energy investments';
            const options = {
                depth: 'basic',
                sources: ['Bloomberg', 'Reuters'],
                timeframe: 'past-month',
                maxResults: 5
            };
            const result = await webSearchService.performWebSearch(query, options);
            expect(result).toBeDefined();
            expect(result.results).toBeInstanceOf(Array);
            expect(result.results.length).toBeLessThanOrEqual(options.maxResults);
            expect(result.totalResults).toBeGreaterThanOrEqual(result.results.length);
            expect(result.executionTime).toBeGreaterThan(0);
            if (result.results.length > 0) {
                const firstResult = result.results[0];
                expect(firstResult.title).toContain(query);
                expect(firstResult.url).toBeDefined();
                expect(firstResult.snippet).toBeDefined();
                expect(firstResult.source).toBeDefined();
                expect(firstResult.relevanceScore).toBeGreaterThanOrEqual(0);
                expect(firstResult.relevanceScore).toBeLessThanOrEqual(1);
            }
        });
        it('should apply source filtering correctly', async () => {
            const query = 'tech stocks';
            const options = {
                depth: 'basic',
                sources: ['Bloomberg'],
                timeframe: 'recent',
                maxResults: 10
            };
            const result = await webSearchService.performWebSearch(query, options);
            if (result.results.length > 0) {
                result.results.forEach(item => {
                    expect(item.source).toBe('Bloomberg');
                });
            }
        });
        it('should use default sources when no sources are provided', async () => {
            const query = 'cryptocurrency market';
            const options = {
                depth: 'basic',
                sources: [],
                timeframe: 'recent',
                maxResults: 10
            };
            const result = await webSearchService.performWebSearch(query, options);
            if (result.results.length > 0) {
                result.results.forEach(item => {
                    expect(defaultSources).toContain(item.source);
                });
            }
        });
        it('should rank results by relevance', async () => {
            const query = 'investment strategies';
            const options = {
                depth: 'comprehensive',
                sources: [],
                timeframe: 'all-time',
                maxResults: 20
            };
            const result = await webSearchService.performWebSearch(query, options);
            if (result.results.length > 1) {
                for (let i = 0; i < result.results.length - 1; i++) {
                    expect(result.results[i].relevanceScore).toBeGreaterThanOrEqual(result.results[i + 1].relevanceScore);
                }
            }
        });
    });
    describe('performDeepResearch', () => {
        it('should return research results with the correct structure', async () => {
            const topic = 'ESG investing trends';
            const options = {
                depth: 'deep',
                focusAreas: ['environmental impact', 'corporate governance'],
                includeSources: ['Bloomberg', 'Reuters'],
                excludeSources: ['Social Media'],
                timeConstraint: 60
            };
            const result = await webSearchService.performDeepResearch(topic, options);
            expect(result).toBeDefined();
            expect(result.summary).toBeDefined();
            expect(result.keyFindings).toBeInstanceOf(Array);
            expect(result.sources).toBeInstanceOf(Array);
            expect(result.relatedTopics).toBeInstanceOf(Array);
            expect(result.confidence).toBeGreaterThanOrEqual(0);
            expect(result.confidence).toBeLessThanOrEqual(1);
            if (result.sources.length > 0) {
                const firstSource = result.sources[0];
                expect(firstSource.title).toBeDefined();
                expect(firstSource.relevance).toBeGreaterThanOrEqual(0);
                expect(firstSource.relevance).toBeLessThanOrEqual(1);
                expect(firstSource.excerpts).toBeInstanceOf(Array);
            }
        });
        it('should exclude specified sources', async () => {
            const topic = 'blockchain technology';
            const options = {
                depth: 'standard',
                focusAreas: ['finance applications'],
                includeSources: [],
                excludeSources: ['Reuters'],
                timeConstraint: 30
            };
            const result = await webSearchService.performDeepResearch(topic, options);
            if (result.sources.length > 0) {
                result.sources.forEach(source => {
                    expect(source.publisher).not.toBe('Reuters');
                });
            }
        });
        it('should generate related topics based on the main topic', async () => {
            const topic = 'artificial intelligence in finance';
            const options = {
                depth: 'comprehensive',
                focusAreas: [],
                includeSources: [],
                excludeSources: [],
                timeConstraint: 120
            };
            const result = await webSearchService.performDeepResearch(topic, options);
            expect(result.relatedTopics.length).toBeGreaterThan(0);
            result.relatedTopics.forEach(relatedTopic => {
                expect(relatedTopic).toContain(topic);
            });
        });
    });
    describe('verifySource', () => {
        it('should verify a source and return a verification result', async () => {
            const source = {
                title: 'Investment Trends 2023',
                url: 'https://example.com/trends-2023',
                publisher: 'Financial Times',
                publishDate: new Date(),
                relevance: 0.85,
                excerpts: ['This is an excerpt from the article.']
            };
            const result = await webSearchService.verifySource(source);
            expect(result).toBeDefined();
            expect(result.source).toEqual(source);
            expect(typeof result.isVerified).toBe('boolean');
            expect(result.credibilityScore).toBeGreaterThanOrEqual(0);
            expect(result.credibilityScore).toBeLessThanOrEqual(1);
            expect(result.factors).toBeDefined();
            expect(result.verificationMethod).toBe('automated-check');
        });
    });
    describe('trackCitations', () => {
        it('should track citations for a research result', async () => {
            const researchResult = {
                summary: 'Research on renewable energy investments',
                keyFindings: ['Finding 1', 'Finding 2'],
                sources: [
                    {
                        title: 'Renewable Energy Report',
                        url: 'https://example.com/report',
                        publisher: 'Bloomberg',
                        relevance: 0.9,
                        excerpts: ['Excerpt 1']
                    },
                    {
                        title: 'Green Investment Outlook',
                        url: 'https://example.com/outlook',
                        publisher: 'Reuters',
                        relevance: 0.8,
                        excerpts: ['Excerpt 2']
                    }
                ],
                relatedTopics: ['Topic 1', 'Topic 2'],
                confidence: 0.85
            };
            const result = await webSearchService.trackCitations(researchResult);
            expect(result).toBeDefined();
            expect(result.researchTopic).toBeDefined();
            expect(result.totalCitations).toBeGreaterThan(0);
            expect(result.citations).toBeInstanceOf(Array);
            expect(result.citations.length).toBe(result.totalCitations);
            expect(result.citationGraph).toBeDefined();
            expect(result.citationGraph.nodes).toBeInstanceOf(Array);
            expect(result.citationGraph.edges).toBeInstanceOf(Array);
            if (result.citations.length > 0) {
                const firstCitation = result.citations[0];
                expect(firstCitation.id).toBeDefined();
                expect(firstCitation.sourceId).toBeDefined();
                expect(firstCitation.citedBy).toBeDefined();
                expect(firstCitation.publicationDate).toBeInstanceOf(Date);
                expect(firstCitation.context).toBeDefined();
                expect(firstCitation.relevance).toBeGreaterThanOrEqual(0);
                expect(firstCitation.relevance).toBeLessThanOrEqual(1);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViLXNlYXJjaC1zZXJ2aWNlLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmljZXMvX190ZXN0c19fL3dlYi1zZWFyY2gtc2VydmljZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOERBQXlEO0FBR3pELFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDaEMsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDO0lBQzlCLE1BQU0sY0FBYyxHQUFHLENBQUMsV0FBVyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0lBQ25FLElBQUksZ0JBQWtDLENBQUM7SUFFdkMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLGdCQUFnQixHQUFHLElBQUkscUNBQWdCLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQ2xFLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtRQUNoQyxFQUFFLENBQUMseURBQXlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkUsTUFBTSxLQUFLLEdBQUcsOEJBQThCLENBQUM7WUFDN0MsTUFBTSxPQUFPLEdBQXFCO2dCQUNoQyxLQUFLLEVBQUUsT0FBTztnQkFDZCxPQUFPLEVBQUUsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDO2dCQUNqQyxTQUFTLEVBQUUsWUFBWTtnQkFDdkIsVUFBVSxFQUFFLENBQUM7YUFDZCxDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFdkUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN0RSxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDMUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFaEQsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLE1BQU0sQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUMzQyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN0QyxNQUFNLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUMxQyxNQUFNLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN6QyxNQUFNLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM3RCxNQUFNLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzNEO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsTUFBTSxLQUFLLEdBQUcsYUFBYSxDQUFDO1lBQzVCLE1BQU0sT0FBTyxHQUFxQjtnQkFDaEMsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLENBQUMsV0FBVyxDQUFDO2dCQUN0QixTQUFTLEVBQUUsUUFBUTtnQkFDbkIsVUFBVSxFQUFFLEVBQUU7YUFDZixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFdkUsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO29CQUM1QixNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDeEMsQ0FBQyxDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZFLE1BQU0sS0FBSyxHQUFHLHVCQUF1QixDQUFDO1lBQ3RDLE1BQU0sT0FBTyxHQUFxQjtnQkFDaEMsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLEVBQUU7Z0JBQ1gsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFVBQVUsRUFBRSxFQUFFO2FBQ2YsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRXZFLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QixNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtvQkFDNUIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2hELENBQUMsQ0FBQyxDQUFDO2FBQ0o7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLEtBQUssR0FBRyx1QkFBdUIsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBcUI7Z0JBQ2hDLEtBQUssRUFBRSxlQUFlO2dCQUN0QixPQUFPLEVBQUUsRUFBRTtnQkFDWCxTQUFTLEVBQUUsVUFBVTtnQkFDckIsVUFBVSxFQUFFLEVBQUU7YUFDZixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFdkUsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2lCQUN2RzthQUNGO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLE1BQU0sS0FBSyxHQUFHLHNCQUFzQixDQUFDO1lBQ3JDLE1BQU0sT0FBTyxHQUF3QjtnQkFDbkMsS0FBSyxFQUFFLE1BQU07Z0JBQ2IsVUFBVSxFQUFFLENBQUMsc0JBQXNCLEVBQUUsc0JBQXNCLENBQUM7Z0JBQzVELGNBQWMsRUFBRSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUM7Z0JBQ3hDLGNBQWMsRUFBRSxDQUFDLGNBQWMsQ0FBQztnQkFDaEMsY0FBYyxFQUFFLEVBQUU7YUFDbkIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRTFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM3QixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3JDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25ELE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVqRCxJQUFJLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDN0IsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDeEMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDckQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDcEQ7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLEtBQUssR0FBRyx1QkFBdUIsQ0FBQztZQUN0QyxNQUFNLE9BQU8sR0FBd0I7Z0JBQ25DLEtBQUssRUFBRSxVQUFVO2dCQUNqQixVQUFVLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQztnQkFDcEMsY0FBYyxFQUFFLEVBQUU7Z0JBQ2xCLGNBQWMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQkFDM0IsY0FBYyxFQUFFLEVBQUU7YUFDbkIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sZ0JBQWdCLENBQUMsbUJBQW1CLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRTFFLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUM3QixNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtvQkFDOUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUMvQyxDQUFDLENBQUMsQ0FBQzthQUNKO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsd0RBQXdELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEUsTUFBTSxLQUFLLEdBQUcsb0NBQW9DLENBQUM7WUFDbkQsTUFBTSxPQUFPLEdBQXdCO2dCQUNuQyxLQUFLLEVBQUUsZUFBZTtnQkFDdEIsVUFBVSxFQUFFLEVBQUU7Z0JBQ2QsY0FBYyxFQUFFLEVBQUU7Z0JBQ2xCLGNBQWMsRUFBRSxFQUFFO2dCQUNsQixjQUFjLEVBQUUsR0FBRzthQUNwQixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFMUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUFFO2dCQUMxQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hDLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1FBQzVCLEVBQUUsQ0FBQyx5REFBeUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RSxNQUFNLE1BQU0sR0FBRztnQkFDYixLQUFLLEVBQUUsd0JBQXdCO2dCQUMvQixHQUFHLEVBQUUsaUNBQWlDO2dCQUN0QyxTQUFTLEVBQUUsaUJBQWlCO2dCQUM1QixXQUFXLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ3ZCLFNBQVMsRUFBRSxJQUFJO2dCQUNmLFFBQVEsRUFBRSxDQUFDLHNDQUFzQyxDQUFDO2FBQ25ELENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDckMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzVELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyw4Q0FBOEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RCxNQUFNLGNBQWMsR0FBRztnQkFDckIsT0FBTyxFQUFFLDBDQUEwQztnQkFDbkQsV0FBVyxFQUFFLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQztnQkFDdkMsT0FBTyxFQUFFO29CQUNQO3dCQUNFLEtBQUssRUFBRSx5QkFBeUI7d0JBQ2hDLEdBQUcsRUFBRSw0QkFBNEI7d0JBQ2pDLFNBQVMsRUFBRSxXQUFXO3dCQUN0QixTQUFTLEVBQUUsR0FBRzt3QkFDZCxRQUFRLEVBQUUsQ0FBQyxXQUFXLENBQUM7cUJBQ3hCO29CQUNEO3dCQUNFLEtBQUssRUFBRSwwQkFBMEI7d0JBQ2pDLEdBQUcsRUFBRSw2QkFBNkI7d0JBQ2xDLFNBQVMsRUFBRSxTQUFTO3dCQUNwQixTQUFTLEVBQUUsR0FBRzt3QkFDZCxRQUFRLEVBQUUsQ0FBQyxXQUFXLENBQUM7cUJBQ3hCO2lCQUNGO2dCQUNELGFBQWEsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUM7Z0JBQ3JDLFVBQVUsRUFBRSxJQUFJO2FBQ2pCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFnQixDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVyRSxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDN0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMzQyxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQzVELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3pELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUV6RCxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDN0MsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNELE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQzVDLE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFELE1BQU0sQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDeEQ7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBXZWJTZWFyY2hTZXJ2aWNlIH0gZnJvbSAnLi4vd2ViLXNlYXJjaC1zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNlYXJjaE9wdGlvbnMsIERlZXBSZXNlYXJjaE9wdGlvbnMgfSBmcm9tICcuLi8uLi9tb2RlbHMvc2VydmljZXMnO1xuXG5kZXNjcmliZSgnV2ViU2VhcmNoU2VydmljZScsICgpID0+IHtcbiAgY29uc3QgYXBpS2V5ID0gJ3Rlc3QtYXBpLWtleSc7XG4gIGNvbnN0IGRlZmF1bHRTb3VyY2VzID0gWydCbG9vbWJlcmcnLCAnUmV1dGVycycsICdGaW5hbmNpYWwgVGltZXMnXTtcbiAgbGV0IHdlYlNlYXJjaFNlcnZpY2U6IFdlYlNlYXJjaFNlcnZpY2U7XG4gIFxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3ZWJTZWFyY2hTZXJ2aWNlID0gbmV3IFdlYlNlYXJjaFNlcnZpY2UoYXBpS2V5LCBkZWZhdWx0U291cmNlcyk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ3BlcmZvcm1XZWJTZWFyY2gnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2VhcmNoIHJlc3VsdHMgd2l0aCB0aGUgY29ycmVjdCBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9ICdyZW5ld2FibGUgZW5lcmd5IGludmVzdG1lbnRzJztcbiAgICAgIGNvbnN0IG9wdGlvbnM6IFdlYlNlYXJjaE9wdGlvbnMgPSB7XG4gICAgICAgIGRlcHRoOiAnYmFzaWMnLFxuICAgICAgICBzb3VyY2VzOiBbJ0Jsb29tYmVyZycsICdSZXV0ZXJzJ10sXG4gICAgICAgIHRpbWVmcmFtZTogJ3Bhc3QtbW9udGgnLFxuICAgICAgICBtYXhSZXN1bHRzOiA1XG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3ZWJTZWFyY2hTZXJ2aWNlLnBlcmZvcm1XZWJTZWFyY2gocXVlcnksIG9wdGlvbnMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXN1bHRzKS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHMubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKG9wdGlvbnMubWF4UmVzdWx0cyk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsUmVzdWx0cykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbChyZXN1bHQucmVzdWx0cy5sZW5ndGgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5leGVjdXRpb25UaW1lKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBcbiAgICAgIGlmIChyZXN1bHQucmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0UmVzdWx0ID0gcmVzdWx0LnJlc3VsdHNbMF07XG4gICAgICAgIGV4cGVjdChmaXJzdFJlc3VsdC50aXRsZSkudG9Db250YWluKHF1ZXJ5KTtcbiAgICAgICAgZXhwZWN0KGZpcnN0UmVzdWx0LnVybCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KGZpcnN0UmVzdWx0LnNuaXBwZXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdFJlc3VsdC5zb3VyY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdFJlc3VsdC5yZWxldmFuY2VTY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgZXhwZWN0KGZpcnN0UmVzdWx0LnJlbGV2YW5jZVNjb3JlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgYXBwbHkgc291cmNlIGZpbHRlcmluZyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9ICd0ZWNoIHN0b2Nrcyc7XG4gICAgICBjb25zdCBvcHRpb25zOiBXZWJTZWFyY2hPcHRpb25zID0ge1xuICAgICAgICBkZXB0aDogJ2Jhc2ljJyxcbiAgICAgICAgc291cmNlczogWydCbG9vbWJlcmcnXSxcbiAgICAgICAgdGltZWZyYW1lOiAncmVjZW50JyxcbiAgICAgICAgbWF4UmVzdWx0czogMTBcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdlYlNlYXJjaFNlcnZpY2UucGVyZm9ybVdlYlNlYXJjaChxdWVyeSwgb3B0aW9ucyk7XG4gICAgICBcbiAgICAgIGlmIChyZXN1bHQucmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlc3VsdC5yZXN1bHRzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGl0ZW0uc291cmNlKS50b0JlKCdCbG9vbWJlcmcnKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCBzb3VyY2VzIHdoZW4gbm8gc291cmNlcyBhcmUgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBxdWVyeSA9ICdjcnlwdG9jdXJyZW5jeSBtYXJrZXQnO1xuICAgICAgY29uc3Qgb3B0aW9uczogV2ViU2VhcmNoT3B0aW9ucyA9IHtcbiAgICAgICAgZGVwdGg6ICdiYXNpYycsXG4gICAgICAgIHNvdXJjZXM6IFtdLFxuICAgICAgICB0aW1lZnJhbWU6ICdyZWNlbnQnLFxuICAgICAgICBtYXhSZXN1bHRzOiAxMFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2ViU2VhcmNoU2VydmljZS5wZXJmb3JtV2ViU2VhcmNoKHF1ZXJ5LCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5yZXN1bHRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVzdWx0LnJlc3VsdHMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICBleHBlY3QoZGVmYXVsdFNvdXJjZXMpLnRvQ29udGFpbihpdGVtLnNvdXJjZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgcmFuayByZXN1bHRzIGJ5IHJlbGV2YW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZXJ5ID0gJ2ludmVzdG1lbnQgc3RyYXRlZ2llcyc7XG4gICAgICBjb25zdCBvcHRpb25zOiBXZWJTZWFyY2hPcHRpb25zID0ge1xuICAgICAgICBkZXB0aDogJ2NvbXByZWhlbnNpdmUnLFxuICAgICAgICBzb3VyY2VzOiBbXSxcbiAgICAgICAgdGltZWZyYW1lOiAnYWxsLXRpbWUnLFxuICAgICAgICBtYXhSZXN1bHRzOiAyMFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2ViU2VhcmNoU2VydmljZS5wZXJmb3JtV2ViU2VhcmNoKHF1ZXJ5LCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3VsdC5yZXN1bHRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZXN1bHQucmVzdWx0cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICBleHBlY3QocmVzdWx0LnJlc3VsdHNbaV0ucmVsZXZhbmNlU2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocmVzdWx0LnJlc3VsdHNbaSArIDFdLnJlbGV2YW5jZVNjb3JlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCdwZXJmb3JtRGVlcFJlc2VhcmNoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHJlc2VhcmNoIHJlc3VsdHMgd2l0aCB0aGUgY29ycmVjdCBzdHJ1Y3R1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0b3BpYyA9ICdFU0cgaW52ZXN0aW5nIHRyZW5kcyc7XG4gICAgICBjb25zdCBvcHRpb25zOiBEZWVwUmVzZWFyY2hPcHRpb25zID0ge1xuICAgICAgICBkZXB0aDogJ2RlZXAnLFxuICAgICAgICBmb2N1c0FyZWFzOiBbJ2Vudmlyb25tZW50YWwgaW1wYWN0JywgJ2NvcnBvcmF0ZSBnb3Zlcm5hbmNlJ10sXG4gICAgICAgIGluY2x1ZGVTb3VyY2VzOiBbJ0Jsb29tYmVyZycsICdSZXV0ZXJzJ10sXG4gICAgICAgIGV4Y2x1ZGVTb3VyY2VzOiBbJ1NvY2lhbCBNZWRpYSddLFxuICAgICAgICB0aW1lQ29uc3RyYWludDogNjBcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHdlYlNlYXJjaFNlcnZpY2UucGVyZm9ybURlZXBSZXNlYXJjaCh0b3BpYywgb3B0aW9ucyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1bW1hcnkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmtleUZpbmRpbmdzKS50b0JlSW5zdGFuY2VPZihBcnJheSk7XG4gICAgICBleHBlY3QocmVzdWx0LnNvdXJjZXMpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVsYXRlZFRvcGljcykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb25maWRlbmNlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jb25maWRlbmNlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEpO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnNvdXJjZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBmaXJzdFNvdXJjZSA9IHJlc3VsdC5zb3VyY2VzWzBdO1xuICAgICAgICBleHBlY3QoZmlyc3RTb3VyY2UudGl0bGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdFNvdXJjZS5yZWxldmFuY2UpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICAgIGV4cGVjdChmaXJzdFNvdXJjZS5yZWxldmFuY2UpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMSk7XG4gICAgICAgIGV4cGVjdChmaXJzdFNvdXJjZS5leGNlcnB0cykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgZXhjbHVkZSBzcGVjaWZpZWQgc291cmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRvcGljID0gJ2Jsb2NrY2hhaW4gdGVjaG5vbG9neSc7XG4gICAgICBjb25zdCBvcHRpb25zOiBEZWVwUmVzZWFyY2hPcHRpb25zID0ge1xuICAgICAgICBkZXB0aDogJ3N0YW5kYXJkJyxcbiAgICAgICAgZm9jdXNBcmVhczogWydmaW5hbmNlIGFwcGxpY2F0aW9ucyddLFxuICAgICAgICBpbmNsdWRlU291cmNlczogW10sXG4gICAgICAgIGV4Y2x1ZGVTb3VyY2VzOiBbJ1JldXRlcnMnXSxcbiAgICAgICAgdGltZUNvbnN0cmFpbnQ6IDMwXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3ZWJTZWFyY2hTZXJ2aWNlLnBlcmZvcm1EZWVwUmVzZWFyY2godG9waWMsIG9wdGlvbnMpO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LnNvdXJjZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXN1bHQuc291cmNlcy5mb3JFYWNoKHNvdXJjZSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHNvdXJjZS5wdWJsaXNoZXIpLm5vdC50b0JlKCdSZXV0ZXJzJyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgcmVsYXRlZCB0b3BpY3MgYmFzZWQgb24gdGhlIG1haW4gdG9waWMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0b3BpYyA9ICdhcnRpZmljaWFsIGludGVsbGlnZW5jZSBpbiBmaW5hbmNlJztcbiAgICAgIGNvbnN0IG9wdGlvbnM6IERlZXBSZXNlYXJjaE9wdGlvbnMgPSB7XG4gICAgICAgIGRlcHRoOiAnY29tcHJlaGVuc2l2ZScsXG4gICAgICAgIGZvY3VzQXJlYXM6IFtdLFxuICAgICAgICBpbmNsdWRlU291cmNlczogW10sXG4gICAgICAgIGV4Y2x1ZGVTb3VyY2VzOiBbXSxcbiAgICAgICAgdGltZUNvbnN0cmFpbnQ6IDEyMFxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2ViU2VhcmNoU2VydmljZS5wZXJmb3JtRGVlcFJlc2VhcmNoKHRvcGljLCBvcHRpb25zKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5yZWxhdGVkVG9waWNzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgcmVzdWx0LnJlbGF0ZWRUb3BpY3MuZm9yRWFjaChyZWxhdGVkVG9waWMgPT4ge1xuICAgICAgICBleHBlY3QocmVsYXRlZFRvcGljKS50b0NvbnRhaW4odG9waWMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ3ZlcmlmeVNvdXJjZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZlcmlmeSBhIHNvdXJjZSBhbmQgcmV0dXJuIGEgdmVyaWZpY2F0aW9uIHJlc3VsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNvdXJjZSA9IHtcbiAgICAgICAgdGl0bGU6ICdJbnZlc3RtZW50IFRyZW5kcyAyMDIzJyxcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS90cmVuZHMtMjAyMycsXG4gICAgICAgIHB1Ymxpc2hlcjogJ0ZpbmFuY2lhbCBUaW1lcycsXG4gICAgICAgIHB1Ymxpc2hEYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICByZWxldmFuY2U6IDAuODUsXG4gICAgICAgIGV4Y2VycHRzOiBbJ1RoaXMgaXMgYW4gZXhjZXJwdCBmcm9tIHRoZSBhcnRpY2xlLiddXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3ZWJTZWFyY2hTZXJ2aWNlLnZlcmlmeVNvdXJjZShzb3VyY2UpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zb3VyY2UpLnRvRXF1YWwoc291cmNlKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzdWx0LmlzVmVyaWZpZWQpLnRvQmUoJ2Jvb2xlYW4nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3JlZGliaWxpdHlTY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3JlZGliaWxpdHlTY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmFjdG9ycykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudmVyaWZpY2F0aW9uTWV0aG9kKS50b0JlKCdhdXRvbWF0ZWQtY2hlY2snKTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICBkZXNjcmliZSgndHJhY2tDaXRhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB0cmFjayBjaXRhdGlvbnMgZm9yIGEgcmVzZWFyY2ggcmVzdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZWFyY2hSZXN1bHQgPSB7XG4gICAgICAgIHN1bW1hcnk6ICdSZXNlYXJjaCBvbiByZW5ld2FibGUgZW5lcmd5IGludmVzdG1lbnRzJyxcbiAgICAgICAga2V5RmluZGluZ3M6IFsnRmluZGluZyAxJywgJ0ZpbmRpbmcgMiddLFxuICAgICAgICBzb3VyY2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdSZW5ld2FibGUgRW5lcmd5IFJlcG9ydCcsXG4gICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL3JlcG9ydCcsXG4gICAgICAgICAgICBwdWJsaXNoZXI6ICdCbG9vbWJlcmcnLFxuICAgICAgICAgICAgcmVsZXZhbmNlOiAwLjksXG4gICAgICAgICAgICBleGNlcnB0czogWydFeGNlcnB0IDEnXVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgdGl0bGU6ICdHcmVlbiBJbnZlc3RtZW50IE91dGxvb2snLFxuICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9vdXRsb29rJyxcbiAgICAgICAgICAgIHB1Ymxpc2hlcjogJ1JldXRlcnMnLFxuICAgICAgICAgICAgcmVsZXZhbmNlOiAwLjgsXG4gICAgICAgICAgICBleGNlcnB0czogWydFeGNlcnB0IDInXVxuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgcmVsYXRlZFRvcGljczogWydUb3BpYyAxJywgJ1RvcGljIDInXSxcbiAgICAgICAgY29uZmlkZW5jZTogMC44NVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgd2ViU2VhcmNoU2VydmljZS50cmFja0NpdGF0aW9ucyhyZXNlYXJjaFJlc3VsdCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc2VhcmNoVG9waWMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsQ2l0YXRpb25zKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNpdGF0aW9ucykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jaXRhdGlvbnMubGVuZ3RoKS50b0JlKHJlc3VsdC50b3RhbENpdGF0aW9ucyk7XG4gICAgICBleHBlY3QocmVzdWx0LmNpdGF0aW9uR3JhcGgpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNpdGF0aW9uR3JhcGgubm9kZXMpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY2l0YXRpb25HcmFwaC5lZGdlcykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgXG4gICAgICBpZiAocmVzdWx0LmNpdGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGZpcnN0Q2l0YXRpb24gPSByZXN1bHQuY2l0YXRpb25zWzBdO1xuICAgICAgICBleHBlY3QoZmlyc3RDaXRhdGlvbi5pZCkudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KGZpcnN0Q2l0YXRpb24uc291cmNlSWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdENpdGF0aW9uLmNpdGVkQnkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdENpdGF0aW9uLnB1YmxpY2F0aW9uRGF0ZSkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gICAgICAgIGV4cGVjdChmaXJzdENpdGF0aW9uLmNvbnRleHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChmaXJzdENpdGF0aW9uLnJlbGV2YW5jZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgZXhwZWN0KGZpcnN0Q2l0YXRpb24ucmVsZXZhbmNlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pOyJdfQ==